<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:href="@{/static/assets/css/post.css}" rel="stylesheet">
    <link th:href="@{/static/assets/css/all.css}" rel="stylesheet">

</head>
<style>
    .imageIcon{
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin: 8px;
    }
</style>
<body>
<aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-items current-page">
            <a class="nav-link collapsed" th:href="@{/index}">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
        </li>


        <li class="nav-item">
            <a class="nav-link collapsed" sec:authorize="hasAuthority('ADMIN') or hasAuthority('SYS_ADMIN')" th:href="@{/dashboard}">
                <i class="bi bi-grid"></i>
                <span>Dashboard</span>
            </a>
        </li>



        <li class="nav-heading">Pages</li>

        <li class="nav-item">
            <a class="nav-link collapsed" th:href="@{/profile}">
                <i class="bi bi-person"></i>
                <span>Profile</span>
            </a>
        </li><!-- End Profile Page Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" sec:authorize="hasAuthority('ADMIN') or hasAuthority('SYS_ADMIN')" th:href="@{/list}">
                <i class="bi bi-question-circle"></i>
                <span>UserList</span>
            </a>
        </li><!-- End F.A.Q Page Nav -->

        <li class="nav-items">
            <a class="nav-link collapsed" th:href="@{/bookmark}">
                <i class="far fa-bookmark"></i> Bookmarks</a>
        </li>

        <li class="nav-items">
            <a class="nav-link collapsed" th:href="@{/event}">
                <i class="bi bi-calendar-event"></i>
                <span>Event</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link collapsed" th:href="@{/guidelines}">
                <i class="bi bi-file-ruled-fill"></i>
                <span>Term & Policy</span>
            </a>
        </li>



        <!-- Inside your Thymeleaf template -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#icons-nav" data-bs-toggle="collapse" href="#" onclick="getCommunities()">
                <i class="bi bi-people"></i><span>Groups</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="icons-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                <!-- Iterate over groups and generate list items -->
                <li>
                    <a th:href="@{/group}" sec:authorize="hasAuthority('ADMIN') or hasAuthority('SYS_ADMIN')">
                        <i class="bi bi-plus" style="font-size: 20px"></i><span>Create Community</span>
                    </a>
                    <div id="groupList">

                    </div>
                </li>

            </ul>
        </li><!-- End Icons Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" th:href="@{/logout}">
                <i class="bi bi-box-arrow-in-right"></i>
                <span>Logout</span>
            </a>
        </li><!-- End Login Page Nav -->



    </ul>

</aside><!-- End Sidebar-->
</body>
<script>
    const getCommunities = () => {
        console.log("Click event is occurred");
        fetch("/communityview", {
            method: 'GET'
        })
            .then(response => response.json())
            .then(data => {
                const groupDropDown = document.getElementById('icons-nav');
                const groupList = document.getElementById('groupList');
                if (data !== null) {
                    groupList.innerHTML='';
                    data.forEach(group => {
                        const li = document.createElement('li');
                        const userImage = document.createElement('img'); // Creating img element
                        userImage.src = group.image; // Setting src attribute
                        userImage.alt = group.name; // Setting alt attribute
                        userImage.classList.add('imageIcon'); // Adding CSS class

                        const anchor = document.createElement('a');
                        anchor.href = "/groupPage/" + group.id;

                        anchor.appendChild(userImage); // Append image to anchor

                        const span = document.createElement('span');
                        span.textContent = group.name;

                        anchor.appendChild(span); // Append span to anchor

                        li.appendChild(anchor); // Append anchor to list item
                        groupList.appendChild(anchor);
                        groupDropDown.appendChild(groupList); // Append list item to dropdown

                    })
                }
            })
    }
</script>
</html>